# Repository Guidelines

## Project Structure & Module Organization
核心 Pascal 源码集中在 `cad_source/`，其中 `zcad.lpi`、`zengine/` 和 `components/` 下的单元分别负责主程序、引擎与可复用控件。运行时资源与示例位于 `environment/runtimefiles/`，`cad/` 会在构建流程中生成完整的可执行发行目录。文档与用户指南位于 `docs/` 与 `cad_source/docs/`，测试工件分别收敛在 `cad_source/components/zcontainers/tests` 与 `cad_source/zengine/tests`。

## Build, Test, and Development Commands
先通过 `make installpkgstolaz LP=/path/to/lazarus PCP=~/.lazarus` 将内置组件注册到 Lazarus，仅需一次。使用 `make clean` 清理生成物，随后运行 `make zcadenv` 或 `make zcadelectrotechenv` 准备运行时资产。完成后执行 `make zcad LP=... PCP=...`（或 `make zcadelectrotech ...`）编译目标二进制。快速查看版本信息可用 `make version`，若需构建离线文档则运行 `make documentation`。持续开发时建议通过 `shift-F9` 在 IDE 内触发全量重建，以规避 FPC 的增量构建问题。

## Coding Style & Naming Conventions
项目依赖 Lazarus JEDI Code Formatter 配置 `cad_source/zcad.jcf`，约定 **2 空格缩进**、空格替换制表符以及 90 列换行。新单元使用 PascalCase 命名（如 `uzccommand...`），类名采用 `T` 前缀，接口与记录遵循现有文件的驼峰式模式。提交前请运行 JCF 或 IDE 内置格式化，并保持 UTF-8/ASCII 文档编码。资源和脚本路径统一使用正斜杠。

## Testing Guidelines
单元测试通过顶层 `make tests LP=... PCP=...` 触发，该目标会分别构建 zcontainers 与 zengine 的测试套件。新增测试应放置在对应模块的 `tests/` 子目录，并以 `test*.pas` 命名。鼓励在 PR 描述中附带关键测试输出或截图，尤其是渲染相关改动。

## Commit & Pull Request Guidelines
历史记录主要采用“动词开头 + 描述 + 可选 issue 编号”的写法（如 `Fix ...`, `Merge pull request #...`）。提交信息保持一句话摘要，必要时在正文添加复现步骤。PR 需包含：变更摘要、影响范围、测试方式、以及相关 issue 链接或问题编号；若 UI 或电气组件有调整，请附带 `issue-images/` 风格的截图。确保分支与主干保持同步，避免引入未跟踪的生成文件。

## Environment & Packaging Tips
构建脚本会覆盖 `cad/` 与 `cad_source/autogenerated/`，开发前请备份自定义资源。若在非拉丁字符路径下工作，建议按照 `BUILD_FROM_SOURCES.md` 中的做法重定向 Lazarus 配置至 ASCII 路径，以避免 `make` 执行失败。
